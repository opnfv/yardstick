<!DOCTYPE html>
<html>

<!--
 Copyright (c) 2017 Rajesh Kudaka <4k.rajesh@gmail.com>
 Copyright (c) 2018 Intel Corporation.

 All rights reserved. This program and the accompanying materials
 are made available under the terms of the Apache License, Version 2.0
 which accompanies this distribution, and is available at
 http://www.apache.org/licenses/LICENSE-2.0
-->

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.5/themes/default/style.min.css" />
        <link rel="stylesheet" href="{{template_dir}}/nsb_report.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="{{template_dir}}/report.js"></script>
    </head>
    <body>
        <div class="container" style="width:100%">
            <div class="row"><!-- header can be id here-->
                <header class="jumbotron text-center">
                    <h1>Yardstick User Interface</h1>
                    <h4>Report of {{task_id}} Generated</h4>
                </header>
            </div> <!-- end row -->
            <div class="row" style="height:500px">
                <div class="col-md-2 control-pane">
                    <div id="data_selector">
                    </div> <!-- end data-selector -->
                </div> <!-- end control-pane -->
                <div class="col-md-10 data-pane" >
                    <div id="graph"></div>
                </div> <!-- end data-pane-->
            </div><!-- end row -->
            <div class="row" id="table-pane">
                <div class="table-responsive col-md-12" >
                    <table class="table table-hover"></table>
                </div>
            </div> <!-- end row, table-pane -->
        </div> <!-- end container -->

        <script type="text/javascript">
            var arr, jstree_data, timestamps;
            arr={{table|safe}}
            timestamps = {{Timestamps|safe}}
            jstree_data = {{jstree_nodes|safe}}

            create_table(arr, timestamps);
            create_jstree(jstree_data);
            render_highcharts([''], timestamps)

            $('#data_selector').on('check_node.jstree uncheck_node.jstree', function (e, data){

                var selected_leaves = [];
                new_arr = {};
                deleteRows();

                for (var i=0; i < data.selected.length; i++){
                    node = data.instance.get_node(data.selected[i])
                    if (node.children.length == 0){
                        point = {"name": node.id, "data": arr[node.id], "visible": true }
                        // Create new array for table to show only subset of metrics
                        new_arr[node.id] = arr[node.id]
                        selected_leaves.push(point)
                    }
                }

                create_table(new_arr, timestamps);

                render_highcharts(selected_leaves, timestamps)
                // refresh highchart
                var chart = $('#graph').highcharts();
                chart.update({
                    series: selected_leaves,
                });
            });

        </script>
    </body>
</html>
