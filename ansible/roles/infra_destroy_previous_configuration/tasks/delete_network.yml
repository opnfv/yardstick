- name: Destroy old networks created by virt
  virt_net:
    name: "{{ network_item.name }}"
    command: destroy
  when: network_item.name in virt_nets.list_nets

# Ignoring erros as network can be created without being defined.
# This can happen if a user manually creates a network using the virsh command.
# If the network is not defined the undefine code will throw an error.
- name: Undefine old networks defined by virt
  virt_net:
    name: "{{ network_item.name }}"
    command: undefine
  when: network_item.name in virt_nets.list_nets
  ignore_errors: yes

- name: Destroy ovs bridge if it exists
  openvswitch_bridge:
    bridge: "{{ network_item.name }}"
    state: absent

- name: Check if linux bridge is present
  stat: path="{{ '/sys/class/net/'+network_item.name+'/brif/' }}"
  register: check_linux_bridge

- name: Remove linux bridge if it exists
  shell: |
    ifconfig "{{ network_item.name }}" down
    brctl delbr "{{ network_item.name }}"
  when: check_linux_bridge.stat.exists

