# Copyright (c) 2017 Intel Corporation.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
  - name: Install docker.io if Ubuntu 17.10 or above
    action: "{{ ansible_pkg_mgr }} name=docker.io state=present force=yes"
    when: ansible_distribution_version|float >= 17.10

  - name: End play if Ubuntu 17.10 or above as docker is now installed
    meta: end_play
    when: ansible_distribution_version|float >= 17.10

  - name: add Ubuntu docker repo
    apt_repository: repo='deb [trusted=yes] {{ ubuntu_docker_url }} ubuntu-{{ ansible_distribution_release }} main' state=present

  - name: ensure correct docker version
    action: "{{ ansible_pkg_mgr }} name={{ item }} state=present force=yes"
    with_items: "{{ docker_packages[ansible_os_family] }}"

  - name: remove Ubuntu docker repo
    apt_repository:
      repo: 'deb [trusted=yes] {{ ubuntu_docker_url }} ubuntu-{{ ansible_distribution_release }} main'
      state: absent
      update_cache: no
